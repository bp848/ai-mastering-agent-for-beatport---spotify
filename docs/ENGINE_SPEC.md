# Hybrid-Analog Engine — 技術仕様（ユーザーとの約束）

> プリセットの当てはめではなく、**音量・音質・音圧・音像**を世界最高峰のスタジオ品質に届ける。AI が楽曲の DNA を解析し、ハイブリッド・ループが特徴を最大限に引き出す。

以下の 5 本柱は**製品の約束**である。実装はこれに従い、無断で数値固定・機能削除・矛盾する処理（例: リバーブ追加、診断のランダム化）をしてはならない。

---

## 1. 自己補正ループ（Self-Correction Loop）

**約束:** AI の提案を盲信せず、適用結果をシミュレーションし、目標値との誤差を検知・修正。ダイナミクスを崩さず最適バランスに着地。「AI が提案し、物理演算が承認する」。

**実装対応:**
- `services/audioService.ts`: `optimizeMasteringParams`
- 部分レンダリングで LUFS を計測し、`gain_adjustment_db` を 0.1 dB 単位で補正
- 本番チェーンと同一の Make-up・リミッターでシミュレーション

**破ってはいけないこと:** シミュレーションと本番チェーンの乖離、補正なしの単純ゲイン上げ。

---

## 2. 真空管サチュレーション（Tube & Tape Saturation）

**約束:** デジタルの冷たさを排除。偶数倍音の付加、粘りと重量といった物質感。「実在する音」へ。

**実装対応:**
- `services/audioService.ts`: `buildMasteringChain` 内
- `makeTubeCurve` による WaveShaper（M/S 時: Mid / Side 別ドライブ、Mono 時: パラメータ駆動）
- サチュレーション量は **AI パラメータ**（`tube_drive_amount`）で制御。固定の「レシピ」で上書きしない。

**破ってはいけないこと:** サチュレーションの実質バイパス、他処理の固定値で音を決めつけること。

---

## 3. Pultec ロースタイル（Pultec Style Low-End）

**約束:** 30 Hz 以下をカットしつつ、その直上をレゾナンスで音楽的に強調。キックとベースの分離と、フロアを震わせる音圧・深度の両立。

**実装対応:**
- `services/audioService.ts`: 30 Hz High-Pass でサブをカット → 55 Hz Peaking（Q 0.9）で直上をレゾナンス強調。ゲインは `low_contour_amount` に比例（0〜+2.5 dB）
- 量は **AI パラメータ**（`low_contour_amount`）で制御

**破ってはいけないこと:** 低域を単純ブーストのみで濁らせる、Pultec コンセプトと逆の処理。

---

## 4. トランジェント・シェイパー & クリッパー

**約束:** リミッターで潰さない。リミッター前段でソフトクリッパーによりピークだけを削り、トランジェント（アタック）を保護。音量と鋭利で立体的な音像の両立。

**実装対応:**
- `services/audioService.ts`: `makeClipperCurve(0.99)` で聞こえないピークのみ緩やかに削り（slope 0.04）、リミッター直前に配置。リミッターは attack 5 ms で安全網役に留めトランジェントを潰さない
- リミッターは `params.limiter_ceiling_db` で制御

**破ってはいけないこと:** クリッパーなしでリミッターのみ、またはトランジェントを潰すような強圧縮の固定化。

---

## 5. Neuro-Drive Module（脳内駆動エンジン）

**約束:** 並列ハイパー圧縮＋低域干渉排除＋12 kHz 以上の Air ブーストを原音にミックス。開放感とエネルギー密度、没入感の世界観。

**実装対応:**
- `services/audioService.ts`: 並列経路（Dry / Wet）
- Hyper-Compressor → High-Pass（**250 Hz**、低域干渉排除）→ High-Shelf（12 kHz, +4.5 dB）→ Wet Gain（0.22）→ Dry とマージ
- Wet 量は現状ゲインで制御。**将来的にパラメータ化する場合は、固定値でユーザーを騙さないこと。**

**破ってはいけないこと:** リバーブ・ディレイの追加、約束していない空間効果の付与。

---

## 共通ルール

- **診断結果:** 分析データから決定的に算出する。同一曲で毎回変わるランダム要素は禁止。
- **波形表示:** オリジナルとマスターを同一画面に重ねて比較するコンセプトを維持する。
- **数値:** 現段階で「これで完成」と決め打ちしない。パラメータ化・A/B 検証の余地を残す。

この仕様は、ユーザーへの約束をコードと一致させるためのものである。
